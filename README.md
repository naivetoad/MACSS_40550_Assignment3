# MACSS_40550_Assignment3

## Summary
Our model was modified based on [Schelling's segregation model](https://github.com/jmclip/MACSS-40550-ABM/tree/main/2_Schelling/mesa_schelling) and [Assignment1](https://github.com/naivetoad/MACSS_40550_Assignment1). Schelling's segregation model is a classic agent-based model that shows that even a slight preference for similar neighbors can lead to a higher degree of isolation than we intuitively expect. In this new model, we simulate Cook County. Agents are represented by red and blue circles and placed on a rectangle grid where each cell can hold at most one agent. Agents' happiness depends on the level of homophily of their neighborhoods, as they prefer to be surrounded by neighbors of the same type.\

Additionally, having a city center represented as a black square on the grid, agents' utility now depends on some combination of their travel time from residence to the city center and level of homophily. Moreover, we included an adjustable preference parameter to shift preferences in the utility function with travel time and homophily. Next, we made an agent's happiness threshold dynamic, which increases if being happy on the last move or decreases if being unhappy on the last move. Unhappy agents will relocate to a vacant cell in each model iteration. This process continues until all agents are happy. 

## Changes been made
+ Enlarge the grid to 60x70 blocks mimicking Cook County, where each block represents 1km x 1km block.
+ Add one city center as a fixed agent representing the coordinates of Millennium Park in Cook County. 
+ Create a utility function that computes happiness based on travel time and homophily with an adjustable preference parameter. 
+ Random updating method is used for active agents.
+ Make the happy threshold dynamic, which acts as a learning mechanism. 

## Return to the original model
This model can be transferred to the original Schelling model by:
1. Setting the `Preference(0:Homophily, 1:travel time)` to 0 to full weight to level of homophily and 0 weight to travel times.


## Files
`model.py` Sets up the model itself and calls on agents in each time step\
`server.py` Sets up visualization of agents and adjustable variable control bar\
`run.py` Launches and runs the model

## How to run
1. To install dependencies, use pip and the `requirements.txt` file in this directory
   ```python
   $ pip install -r requirements.txt
3. To run the model interactively, run Python `run.py` in this directory
   ```python
   $ python run.py

## Group members (Alphabetical order)
Gregory Ho, Jiaxuan Zhang, Thomas Yan

## Parameter Sweep
We performed a parameter sweep encompassing three important variables: “density,” “minority percentage,” and “preference.” Each variable was varied systematically to analyze its impact on the model outcomes, which emulate social dynamics within different demographic contexts.
The baseline value for “density” was set to reflect the highly urbanized setting in Cook County, which served as our initial model environment. This parameter directly correlates to the spatial distribution of agents within the simulation. By altering the agent density, we observed varied dynamics in agent interactions and social clustering, enabling us to study the effects of different residential densities on social behaviors. For instance, increasing the agent density may simulate more urban settings, while decreasing it may represent more rural areas. 
“Minority percentage” was initially configured to mirror the demographic composition of Cook County, specifically its non-white population ratio. Adjusting the minority percentage allowed us to explore the model's sensitivity to changes in ethnic composition. This is particularly useful for understanding how diverse or homogeneous racial compositions influence social integration and segregation phenomena in different regions.
“Preference” encompasses preferences related to commute time and homophily. The adjustment shapes the utility function that determines the decision-making processes and happiness of agents. By varying the weight given to commute time versus homophily, we can understand how changes in social and environmental preferences influence residential choices and social network formations. For example, increasing the preference for shorter commute time may represent urban areas where commuting often involves significant travel time and stress, whereas a higher preference for homophily may mimic immigrant groups seeking community networks that offer emotional and logistical support. 

## Single Run
We conducted three distinct simulation runs, each designed to represent different levels of parameterization—low, medium, and high—within our model. These runs were structured to examine the effects of varying degrees of preference for commute time versus homophily on agents’ happiness. Throughout each scenario, we maintained consistent values for "agent density" and "minority percentage." This consistency ensured that these parameters accurately reflected the actual demographic and residential conditions found in Cook County, thereby allowing us to understand the influence of preference changes more clearly.
In the low parameterization scenario, we configured the preference value at 0. This setup meant that agents’ happiness was influenced entirely by homophily, replicating Thomas Schelling's classic segregation model. Shown in Figure 1, the blue and yellow agents show clear segregation, with a large cluster of blue agents dominating left of the space. There is a dense yet smaller cluster of yellow agents, primarily located towards the bottom right of the grid. In addition, over two thousand happy agents indicate that both the majority and minority agents are significantly happier under this parameterization. The placement of the city center does not affect the distribution of agents, which aligns with the simulation parameters where commute considerations are ignored. 
For the medium parameterization, the preference value was set at 0.5, creating an environment where commute time and homophily were equally weighted in determining agents' happiness. Compared to the previous scenario where homophily was the only factor, Figure 2 has more mixing of blue and yellow agents across the grid. This suggests a more integrated pattern of settlement where agents are making compromises between living near similar others and staying close to the central areas. However, there is a large cluster of blue agents occupying areas surrounding the city center, which may reflect how a particular dominant group takes over a city’s central area. The number of happy agents is also significantly lower than in the previous scenario. This decrease in happiness could be indicative of the compromises agents make in this scenario, where not all preferences can be fully satisfied, reflecting a more realistic social compromise.
In the high parameterization scenario, the preference was adjusted to 1 to mimic a homogenous population, meaning that the agents’ happiness depended solely on minimizing commute times. Unlike the previous scenarios, the pattern shown in Figure 3 is more evenly dispersed across the grid. Both blue and yellow agents are spread throughout the area without large, distinct clusters forming around similar agents. This suggests a more integrated setting driven purely by proximity to central locations or workplaces. It appears there is a slightly denser concentration of agents near the city center, consistent with the agents' focus on minimizing commute distances. The number of happy agents is only slightly lower than in the medium parameterization scenario. This simulation offers valuable implications for publication transportation systems in areas of homogenous populations. 

## Batch Run
We conducted a batch run in 50 iterations, each consisting of 100 steps. The parameter "density" was set at 0.7, and we explored six values for "minority percentage" varying from 0 to 0.5, as well as five values for "preference" ranging from 0 to 1. In total, we executed 1500 simulations, which were completed in approximately 35 minutes. The data was collected at every 20 steps, and automatically saved in a CSV file for subsequent statistical analysis and visualization. Using visualization libraries such as Seaborn and Plotly, we produced several boxplots to illustrate the results of the batch run.
According to Figure 4, as the proportion of minority population increases, the average utility for majority agents experience a significant drop, as well as its variability (Yellow Plot). Unlike the majority agents, the utility of minority agents remains relatively stable with a slight increase at the highest minority percentage. The interquartile ranges are consistently narrower, indicating less variability (Green Plot). The number of happy agents decreases dramatically as the proportion of minority population increases (Red Plot). The presence of right outliers at higher proportions of minority population across three box plots indicates the model’s instability in the context of higher minority percentages. 
In Figure 5, as preference increases, the average utility of majority agents and the variability of utility decrease significantly (Yellow Plot). The average utility of minority agents experiences a great drop as preference increases from 0 to 0.25, becomes relatively consistent over the next three preference values, and experiences a slight increase at the highest preference value (Green Plot). In terms of the number of happy agents, there is a similar pattern as the average utility of majority agents (Red Plot). It is important to note that three box plots demonstrate an extreme convergence with a preference value of 1. 
Figure 6 shows that the average utility for majority agents experience a gradual increase in the upper percentile over time, suggesting some improvement in the conditions of these agents (Yellow Plot). In comparison, the utility distribution for minority agents, shown in the green plot, is more consistent across percentiles, suggesting a uniform experience among these agents over time. In addition, the narrower distribution suggests a smaller range of variability (Green Plot). Furthermore, there is a stable number of happy agents with a gradual increase at the upper end of the distribution (Red Plot). The presence of right outliers at step 60, 80, and 100 in the green plot and two clusters of right outliers divided at around 2200 on the y-axis in the red plot demonstrates the model’s instability across steps.

## Designs
Single runs are typically used to understand specific scenarios or to explore the outcomes of particular settings. They help in visualizing the impact of distinct conditions and can be used for demonstration purposes. Furthermore, they facilitate the collection of immediate effects and a deep dive into specific metrics or agent behaviors. 
Batch runs are used for systematic exploration of parameter spaces or for collecting statistical data over a range of scenarios. They are crucial for understanding the robustness of findings and for identifying trends or general behaviors across different settings.
Because we plan to use batch runs extensively to collective data, the model needs to be designed with additional features. We need to ensure its scalability so that the model can handle running many instances in parallel or in sequence efficiently. This may involve optimizing the code, particularly those executed at each simulation step. Additionally, the model should handle a range of inputs without failure, as unattended runs need to be robust against unexpected parameter combinations or simulation states. We also need to design the model to capture a broader spectrum of metrics automatically, such as movement and self-learning behaviors. This helps in conducting thorough analyses post-simulation, enabling a better understanding of the impact across varied settings.
